{"paragraphs":[{"title":"Spark Query Measurement","text":"%spark\n\nimport org.apache.spark._\nimport org.apache.spark.sql._\nimport sqlContext.implicits._\n\n\ncase class DelayRec(flightNumber: String, year: Integer, month: Integer, dayOfMonth: Integer, dayOfWeek: Integer, crsDepTime: Integer, depDelay: Integer, origin: String, distance: Double)\n\nval flightRDD = sc.textFile(\"../../../../Data/2007.csv\").map(line => line.split(\",\")).filter(rec => rec(4).toString() != \"NA\").filter(rec => rec(0) !=\"Year\").filter(rec => rec(16).toString() == \"ORD\").filter(rec => rec(21).toString() != \"1\").map(rec => new DelayRec( rec(9).toString(),rec(0).toInt,rec(1).toInt,rec(2).toInt,rec(3).toInt,rec(5).toInt,rec(15).toInt,rec(16).toString(),rec(18).toDouble))\n\n\nval flightDF = flightRDD.toDF()\nflightDF.createOrReplaceTempView(\"flightView\")\nval t0 = System.nanoTime()\nval result1 = spark.sql(\"select flightNumber, distance from flightView where distance > 1200.0 AND distance < 1300.0\").collect()\nval t1 = System.nanoTime()\nprintln(\"Elapsed time for query using pure spark: \" + (t1 - t0)/1000000 + \" millisecond\")\nval result2 = spark.sql(\"select count(*) from flightView where distance > 1200.0 AND distance < 1300.0\").collect()","user":"anonymous","dateUpdated":"2019-01-13T11:27:55+0200","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala","title":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"import org.apache.spark._\nimport org.apache.spark.sql._\nimport sqlContext.implicits._\ndefined class DelayRec\nflightRDD: org.apache.spark.rdd.RDD[DelayRec] = MapPartitionsRDD[7] at map at <console>:38\nflightDF: org.apache.spark.sql.DataFrame = [flightNumber: string, year: int ... 7 more fields]\nt0: Long = 292286930564618\nresult1: Array[org.apache.spark.sql.Row] = Array([6997,1249.0], [6997,1249.0], [6997,1249.0], [6997,1249.0], [6997,1249.0], [4028,1249.0], [6997,1249.0], [6997,1249.0], [6997,1249.0], [6997,1249.0], [6997,1249.0], [6997,1249.0], [6997,1249.0], [4028,1249.0], [5967,1249.0], [6997,1249.0], [6997,1249.0], [6997,1249.0], [6997,1249.0], [6997,1249.0], [6997,1249.0], [6997,1249.0], [4028,1249.0], [5967,1249.0], [6997,1249.0], [6997,1249.0], [6997,1249.0], [6997,1249.0], [6997,1249.0], [6997,1249.0], [6997,1249.0], [5967,1249.0], [6997,1249.0], [6997,1249.0], [6997,1249.0], [6997,1249.0], [6997,1249.0], [119,1249.0], [119,1249.0], [119,1249.0], [119,1249.0], [119,1249.0], [119,1249.0], [119,1249.0], [119,1249.0], [265,1249.0], [265,1249.0], [265,1249.0], [265,1249.0], [265,1249.0], [265,1249.0...t1: Long = 292298351177331\nElapsed time for query using pure spark: 11420 millisecond\nresult2: Array[org.apache.spark.sql.Row] = Array([3592])\n"}]},"runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":["http://192.168.9.185:4041/jobs/job?id=0","http://192.168.9.185:4041/jobs/job?id=1"],"interpreterSettingId":"spark"}},"apps":[],"jobName":"paragraph_1547038027214_-1443821682","id":"20190109-144707_102449233","dateCreated":"2019-01-09T14:47:07+0200","dateStarted":"2019-01-13T11:27:55+0200","dateFinished":"2019-01-13T11:28:50+0200","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:9816"},{"title":"Step1 - IE Query Measurement (import dependencies)","text":"%dep\n\nz.reset()\n\nz.load(\"/Users/yuval/Workspace/insightedge-training/Day4/FlightDelayDemo/target/FlightDelayDemo-1.0.0-SNAPSHOT.jar\")\n","user":"anonymous","dateUpdated":"2019-01-13T11:29:35+0200","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala","title":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"res0: org.apache.zeppelin.dep.Dependency = org.apache.zeppelin.dep.Dependency@62da4d2a\n"}]},"apps":[],"jobName":"paragraph_1547038385488_1963267793","id":"20190109-145305_803990758","dateCreated":"2019-01-09T14:53:05+0200","dateStarted":"2019-01-13T11:29:35+0200","dateFinished":"2019-01-13T11:29:46+0200","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:9817"},{"title":"Step2 - IE Query Measurement (save to grid)","text":"%spark\n\nimport com.gigaspaces.DelayRec\nimport org.insightedge.spark.implicits.all._\n\n\nval flightRDD = sc.textFile(\"../../../../Data/2007.csv\").map(line => line.split(\",\")).filter(rec => rec(4).toString() != \"NA\").filter(rec => rec(0) !=\"Year\").filter(rec => rec(16).toString() == \"ORD\").filter(rec=> rec(21).toString() != \"1\").map(rec => new DelayRec( rec(9).toString(),rec(0).toInt,rec(1).toInt,rec(2).toInt,rec(3).toInt,rec(5).toInt,rec(15).toInt,rec(16).toString(),rec(18).toDouble))\n\nflightRDD.saveToGrid()\n","user":"anonymous","dateUpdated":"2019-01-13T11:29:49+0200","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala","title":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"import com.gigaspaces.DelayRec\nimport org.insightedge.spark.implicits.all._\nflightRDD: org.apache.spark.rdd.RDD[com.gigaspaces.DelayRec] = MapPartitionsRDD[7] at map at <console>:29\n"}]},"runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":["http://192.168.9.185:4041/jobs/job?id=0"],"interpreterSettingId":"spark"}},"apps":[],"jobName":"paragraph_1547038322031_-999418395","id":"20190109-145202_1609569219","dateCreated":"2019-01-09T14:52:02+0200","dateStarted":"2019-01-13T11:29:49+0200","dateFinished":"2019-01-13T11:30:20+0200","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:9818"},{"title":"Step3 - IE Query Measurement (run query)","text":"\n%spark\n\nval t0 = System.nanoTime()\nval flightRDD = sc.gridSql[com.gigaspaces.DelayRec](\"distance > ? AND distance < ?\", Seq(1200.0,1300.0))\nval t1 = System.nanoTime()\nprintln(\"Elapsed time for query using IE: \" + (t1 - t0)/1000000 + \" millisecond\")\nval count = flightRDD.count()\n","user":"anonymous","dateUpdated":"2019-01-13T11:30:27+0200","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala","title":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"t0: Long = 292406199727445\nflightRDD: org.insightedge.spark.rdd.InsightEdgeSqlRDD[com.gigaspaces.DelayRec] = InsightEdgeSqlRDD[8] at RDD at InsightEdgeAbstractRDD.scala:36\nt1: Long = 292407105045698\nElapsed time for query using IE: 905 millisecond\ncount: Long = 3405\n"}]},"runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":["http://192.168.9.185:4041/jobs/job?id=1"],"interpreterSettingId":"spark"}},"apps":[],"jobName":"paragraph_1547039461889_-492444703","id":"20190109-151101_291276507","dateCreated":"2019-01-09T15:11:01+0200","dateStarted":"2019-01-13T11:30:27+0200","dateFinished":"2019-01-13T11:30:29+0200","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:9819"},{"text":"%spark\n","user":"anonymous","dateUpdated":"2019-01-13T10:57:07+0200","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1547369827303_1996134433","id":"20190113-105707_775026371","dateCreated":"2019-01-13T10:57:07+0200","status":"READY","progressUpdateIntervalMs":500,"$$hashKey":"object:9820"}],"name":"Lab 9.1 Example - SQL Query Benchmark: Spark vs InsightEdge","id":"2E3CJ69PY","noteParams":{},"noteForms":{},"angularObjects":{"spark:shared_process":[]},"config":{"isZeppelinNotebookCronEnable":false,"looknfeel":"default","personalizedMode":"false"},"info":{}}